#!/usr/bin/env bash

# ============================================================
# VpsScriptKit - ç³»ç»Ÿå·¥å…·æ¨¡å—å…¥å£
# @åç§°:         system/entry.sh
# @èŒè´£:
# 1. æ˜¾ç¤ºã€Œç³»ç»Ÿå·¥å…·ã€å­èœå•
# 2. æ¥æ”¶ç”¨æˆ·è¾“å…¥
# 3. åˆ†å‘åˆ°ç³»ç»Ÿå·¥å…·å…·ä½“åŠŸèƒ½
# 4. æ”¯æŒè¿”å›ä¸»èœå•
#
# è®¾è®¡åŸåˆ™: 
# - æ¨¡å—è‡ªé—­ç¯ï¼ˆè¿›å…¥ â†’ æ“ä½œ â†’ è¿”å›ï¼‰
# - ä¸ç›´æ¥å¤„ç†ä¸»èœå•
# - ä¸é€€å‡ºæ•´ä¸ªç¨‹åº
# @ä½œè€…:         Jamison
# @ç‰ˆæœ¬:         0.1.0
# @åˆ›å»ºæ—¥æœŸ:     2026-01-01
# @ä¿®æ”¹æ—¥æœŸ:     2025-01-05
#
# @è®¸å¯è¯:       MIT
# ============================================================

# ------------------------------
# å¼•å…¥ä¾èµ–æ¨¡å—
# ------------------------------

# å¼•å…¥ ç³»ç»Ÿä¿¡æ¯å±•ç¤º
source "${BASE_DIR}/modules/system/status.sh"

# ------------------------------
# ç³»ç»Ÿå·¥å…·æ¨¡å—ä¸»å…¥å£
# ------------------------------

system_entry() {
  # ä½¿ç”¨æ— é™å¾ªç¯ä¿è¯æ¨¡å—ä¸ä¼šæ„å¤–é€€å‡º
  while true; do

    ui clear

    # æ‰“å°æ¨¡å—æ ‡é¢˜
    # ui print home_header "ğŸ› ï¸ ç³»ç»Ÿå·¥å…·"
    ui print page_header_full "âš™ï¸  ç³»ç»Ÿå·¥å…·"

    # æ‰“å°ç³»ç»Ÿå·¥å…·å­èœå•é€‰é¡¹
    # ui_menu_item 1 "æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯"

    ui line

    ui_menu_item 1 0 1 "ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢"
    ui_menu_item 1 6 2 "${BOLD_GREY}ç³»ç»Ÿæ›´æ–°${RESET}"
    ui_menu_item 1 14 3 "${BOLD_GREY}ç³»ç»Ÿæ¸…ç† â–¶${RESET}"

    # ui_menu_item 2 "æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ"
    # ui_menu_item 3 "æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ"
    # ui_menu_item 4 "æŸ¥çœ‹ CPU è´Ÿè½½"

    ui_menu_done
    ui line

    ui_menu_item 2 0 4 "${BOLD_GREY}ä¿®æ”¹ç™»å½•å¯†ç ${RESET}"
    ui_menu_item 2 6 5 "${BOLD_GREY}å¼€å¯ROOTå¯†ç ç™»å½•${RESET}"
    ui_menu_item 2 6 6 "${BOLD_GREY}å¼€æ”¾æ‰€æœ‰ç«¯å£${RESET}"

    ui_menu_item 3 0 7 "${BOLD_GREY}ä¿®æ”¹SSHç«¯å£${RESET}"
    ui_menu_item 3 7 8 "${BOLD_GREY}ä¼˜åŒ–DNSåœ°å€${RESET}"
    ui_menu_item 3 11 9 "${BOLD_GREY}ç¦ç”¨ROOTè´¦æˆ·åˆ›å»ºæ–°è´¦æˆ·${RESET}"

    ui_menu_done

    ui_go_level 0
    
    # è¯»å–ç”¨æˆ·è¾“å…¥å¹¶å­˜å…¥å˜é‡
    local choice
    choice="$(ui read_choice)"

    # æ ¹æ®ç”¨æˆ·è¾“å…¥æ‰§è¡Œä¸åŒæ“ä½œ
    case "$choice" in

      1)
        # é€‰é¡¹ 1: æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
        status_show_all
      ;;

      2)
        # é€‰é¡¹ 2: æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
        system_disk_usage
      ;;

      3)
        # é€‰é¡¹ 3: æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
        system_memory_usage
      ;;

      4)
        # é€‰é¡¹ 4: æŸ¥çœ‹ CPU è´Ÿè½½
        system_cpu_load
      ;;

      0)
        # é€‰é¡¹ 0: è¿”å›ä¸»èœå•
        return
        # ä½¿ç”¨ return è€Œä¸æ˜¯ exitï¼Œè¿”å›åˆ°ä¸Šçº§è°ƒç”¨è€…ï¼ˆrouterï¼‰
      ;;

      *)
        # å¤„ç†éæ³•è¾“å…¥
        ui error "æ— æ•ˆé€‰é¡¹ï¼Œè¯·é‡æ–°è¾“å…¥"
        # çŸ­æš‚æš‚åœï¼Œé¿å…ç«‹åˆ»åˆ·æ–°
        sleep 1
      ;;
    esac

    # åœ¨æ¯æ¬¡æ“ä½œå®Œæˆåæš‚åœï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
    # ui pause
  done
}

# ------------------------------
# ç³»ç»Ÿå·¥å…·åŠŸèƒ½å‡½æ•°
# ------------------------------

system_show_info() {
  # æ¸…ç©ºç»ˆç«¯
  ui clear

  # æ‰“å°åŠŸèƒ½æ ‡é¢˜
  ui print home_header "ğŸ“‹ ç³»ç»Ÿä¿¡æ¯"

  # è¾“å‡ºæ“ä½œç³»ç»Ÿä¿¡æ¯
  uname -a
}

system_disk_usage() {
  # æ¸…ç©ºç»ˆç«¯
  ui clear

  # æ‰“å°åŠŸèƒ½æ ‡é¢˜
  ui print home_header "ğŸ’½ ç£ç›˜ä½¿ç”¨æƒ…å†µ"

  # æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µï¼ˆäººç±»å¯è¯»æ ¼å¼ï¼‰
  df -h
}

system_memory_usage() {
  # æ¸…ç©ºç»ˆç«¯
  ui clear

  # æ‰“å°åŠŸèƒ½æ ‡é¢˜
  ui print home_header "ğŸ§  å†…å­˜ä½¿ç”¨æƒ…å†µ"

  # åˆ¤æ–­ç³»ç»Ÿç±»å‹ï¼ˆmacOS / Linuxï¼‰
  if is_macos; then
    # macOS ä½¿ç”¨ vm_stat æŸ¥çœ‹å†…å­˜
    vm_stat
  else
    # Linux ä½¿ç”¨ free æŸ¥çœ‹å†…å­˜
    free -h
  fi
}

system_cpu_load() {
  # æ¸…ç©ºç»ˆç«¯
  ui clear

  # æ‰“å°åŠŸèƒ½æ ‡é¢˜
  ui print home_header "âš™ï¸ CPU è´Ÿè½½"

  # æ˜¾ç¤º CPU è´Ÿè½½ä¿¡æ¯
  sys_get_uptime
}
