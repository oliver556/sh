#!/usr/bin/env bash

# ==============================================================================
# VpsScriptKit - 自动安装保障
# 
# @文件路径: lib/guards/ensure.sh
# @功能描述: 尝试安装保障（可失败）
# 
# @作者:    Jamison
# @版本:    1.0.0
# @创建日期: 2026-01-12
# ==============================================================================

# ------------------------------------------------------------------------------
# 函数名: ensure_cmd
# 功能:   安装对应命令
# 
# 参数:
#   $1 (string): 需要安装的命令名
#   $2 (string): has_cmd 的检查是否用对应函数的提示
# 
# 返回值:
#   0 - 安装成功
#   1 - 安装失败
# 
# 示例:
#   ensure_cmd
# ------------------------------------------------------------------------------
ensure_cmd() {
  	local cmd="$1"
    local pkg="${2:-$1}"  # 如果 $2 为空，则 pkg = cmd

  	if has_cmd "$cmd"; then
        return 0
    fi

  	print_warn -m "未检测到命令: ${BOLD_WHITE}$cmd${NC}，正在尝试安装..."

    if pkg_install "$pkg"; then
        # 安装后再次检查，防止假成功
        if has_cmd "$cmd"; then
            return 0
        fi
    fi

    print_error -m "无法自动安装: $pkg，请手动安装。"
    return 1
}
