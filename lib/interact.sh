#!/usr/bin/env bash

# =================================================================================
# VpsScriptKit - äº¤äº’ç¡®è®¤å·¥å…· - å‡½æ•°åº“
# @åç§°:         confirm_utils.sh
# @ä½ç½®:        lib/confirm_utils.sh
# @ä½œè€…:         Jamison
# @ç‰ˆæœ¬:         0.1.0
# @åˆ›å»ºæ—¥æœŸ:     2025-12-30
# @ä¿®æ”¹æ—¥æœŸ:     2025-01-04
#
# @è®¸å¯è¯:       MIT
### ============================================================

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_spaces
# æè¿°: ç”ŸæˆæŒ‡å®šæ•°é‡çš„ç©ºæ ¼å­—ç¬¦ä¸²
# å‚æ•°: $1 - éœ€è¦çš„ç©ºæ ¼æ•°é‡ (é»˜è®¤: 2)
# ç¤ºä¾‹: echo "A$(ui_spaces 2)B" -> A  B
# ---------------------------------------------------------------------------------
ui_spaces() {
    local count="${1:-2}"
    ((count < 0)) && count=0
    printf "%*s" "$count" ""
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_confirm
# æè¿°: æŒ‰ (Y/y) é”®ç¡®è®¤ï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›ž/å–æ¶ˆ
# å‚æ•°: $1 - æç¤ºä¿¡æ¯ (é»˜è®¤: ç¡®è®¤æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ)
# è¿”å›ž: 0 (ç¡®è®¤), 1 (å–æ¶ˆ)
# ---------------------------------------------------------------------------------
ui_confirm() {
    local title="$1"
    local user_choice

    echo
    # å¦‚æžœ title ä¸ä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºå…·ä½“çš„æ ‡é¢˜æç¤º
    if [ -n "$title" ]; then
        echo -e "æŒ‰ ${BOLD_RED}(Y/y)${LIGHT_WHITE} é”®ç¡®è®¤æ‰§è¡Œ ${LIGHT_CYAN}${title}${LIGHT_WHITE}ï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›žã€‚"
    else
        echo -e "æŒ‰ ${BOLD_RED}(Y/y)${LIGHT_WHITE} é”®ç¡®è®¤æ‰§è¡Œï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›žã€‚"
    fi
    echo

    # ä½¿ç”¨ read -rp èŽ·å–è¾“å…¥ï¼Œæ”¯æŒ ANSI é¢œè‰²æ¸²æŸ“æç¤ºç¬¦
    read -rp "$(echo -e "${LIGHT_CYAN}ðŸ‘‰ è¯·è¾“å…¥ä½ çš„é€‰æ‹©: ${LIGHT_WHITE}")" user_choice

    case "$user_choice" in
        y|Y)
            return 0  # è¿”å›ž 0, ä»£è¡¨â€œæˆåŠŸ/ç»§ç»­â€
            ;;
        *)
            echo -e "\n${BOLD_YELLOW}æ“ä½œå·²å–æ¶ˆ...${LIGHT_WHITE}"
            sleep 1
            return 1  # è¿”å›ž 1, ä»£è¡¨â€œå¤±è´¥/å–æ¶ˆâ€
            ;;
    esac
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_wait_enter
# æè¿°: ä»»åŠ¡ç»ˆç»“æ—¶çš„ç¡®è®¤ï¼Œå¿…é¡»æŒ‰â€œå›žè½¦é”®â€æ‰èƒ½ç»§ç»­ã€‚
# ---------------------------------------------------------------------------------
ui_wait_enter() {
    ui blank
    ui echo "${BOLD_LIGHT_GREEN}æ‰§è¡Œå®Œæˆ${LIGHT_WHITE}"
    ui echo "${BOLD_LIGHT_WHITE}æŒ‰å›žè½¦é”®è¿”å›ž...${LIGHT_WHITE}"
    # ä¸å¸¦ -nï¼Œå¼ºåˆ¶ç­‰å¾…å›žè½¦
    read -s -r
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_wait (æ•´åˆäº†ä¹‹å‰çš„ pause é€»è¾‘)
# æè¿°: æµç¨‹ä¸­çš„ä¸´æ—¶æš‚åœï¼ŒæŒ‰â€œä»»æ„é”®â€ç«‹å³ç»§ç»­ (æ— éœ€å›žè½¦)ã€‚
# ---------------------------------------------------------------------------------
ui_wait() {
    ui blank
    # ä½¿ç”¨ç®€æ´çš„æç¤ºè¯­ï¼Œå…¼å®¹ pause çš„æ„Ÿè§‰
    ui echo "${LIGHT_CYAN}æŒ‰ä»»æ„é”®ç»§ç»­...${LIGHT_WHITE}"

    # -n 1: è¯»å– 1 ä¸ªå­—ç¬¦ç«‹å³è¿”å›ž
    # -s: é™é»˜æ¨¡å¼ï¼Œä¸å›žæ˜¾è¾“å…¥
    # -r: å…è®¸åæ–œæ 
    read -n 1 -s -r
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_input
# æè¿°: èŽ·å–ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬æ•°æ®ã€‚æ”¯æŒè®¾ç½®é»˜è®¤å€¼ã€‚
# å‚æ•°: $1 - æç¤ºè¯­, $2 - é»˜è®¤å€¼ (å¯é€‰)
# ---------------------------------------------------------------------------------
ui_input() {
    local prompt="$1"
    local default_val="${2:-}"
    local input_val
    
    # æç¤ºç¬¦é€šè¿‡ read -p è¾“å‡ºåˆ° stderrï¼Œç¡®ä¿ $() åªèƒ½æ•èŽ·åˆ° echo çš„å€¼
    if [ -n "$default_val" ]; then
        read -rp "$(ui echo "ðŸ‘‰${LIGHT_CYAN}$(ui_spaces)${prompt} [é»˜è®¤: ${BOLD_WHITE}${default_val}${LIGHT_CYAN}]: ${LIGHT_WHITE}")" input_val
        echo "${input_val:-$default_val}"
    else
        read -rp "$(ui echo "ðŸ‘‰${LIGHT_CYAN}$(ui_spaces)${prompt}: ${LIGHT_WHITE}")" input_val
        echo "$input_val"
    fi
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_read_choice
# æè¿°: ä¸“é—¨ç”¨äºŽèœå•é€‰æ‹©çš„è¯»å–ã€‚ä½œä¸º ui_input çš„å¿«æ·å°è£…ã€‚
# ---------------------------------------------------------------------------------
ui_read_choice() {
    # ç»Ÿä¸€è°ƒç”¨ ui_inputï¼Œä¿æŒç•Œé¢æŒ‡å¼•ç¬¦å’Œé€»è¾‘çš„ä¸€è‡´æ€§
    ui_input "è¯·è¾“å…¥é€‰é¡¹"
}

# ---------------------------------------------------------------------------------
# çŠ¶æ€åé¦ˆå‡½æ•°
# ---------------------------------------------------------------------------------
# çº¯æ–‡æœ¬è¾“å‡ºï¼ˆæœ€ä½Žçº§ï¼‰
ui_text() {
    ui echo "$1"
}
# ç”¨æˆ·æç¤º / è¯´æ˜Žï¼ˆåŠ ç²—ç™½ï¼‰
ui_tip() {
    ui echo "${BOLD_WHITE}âž¤$(ui_spaces 1)$1${RESET}"
}
# ä¿¡æ¯æç¤ºï¼ˆä¸­æ€§çŠ¶æ€ï¼‰
ui_info()  {
    ui echo "${BLUE}â„¹$(ui_spaces 1)$1${LIGHT_WHITE}"
}
# æˆåŠŸæç¤º
ui_success() {
    ui echo "${BOLD_GREEN}âœ”$(ui_spaces 1)$1${LIGHT_WHITE}"
}
# è­¦å‘Šæç¤ºï¼ˆéžè‡´å‘½ï¼‰
ui_warn()  {
    ui echo "${BOLD_YELLOW}âš $(ui_spaces 1)$1${LIGHT_WHITE}"
}
# é”™è¯¯æç¤ºï¼ˆè‡´å‘½ï¼‰
ui_error() {
    ui echo "${BOLD_RED}âœ˜$(ui_spaces 1)$1${LIGHT_WHITE}";
}
# èœå•é€‰é¡¹é”™è¯¯ï¼ˆéžè‡´å‘½ï¼‰
ui_warn_menu()  {
    ui echo "${BOLD_YELLOW}âŒ$(ui_spaces)$1${LIGHT_WHITE}"
}

# ---------------------------------------------------------------------------------
# å‡½æ•°: ui_exit
# æè¿°: æ‰“å°å‘Šåˆ«è¯­å¹¶é€€å‡ºè„šæœ¬
# ---------------------------------------------------------------------------------
ui_exit() {
    ui clear
    ui line
    ui echo "${BOLD_GREEN}ðŸ‘‹$(ui_spaces)æ„Ÿè°¢ä½¿ç”¨ VpsScriptKitï¼${LIGHT_WHITE}"
    ui echo "${BOLD_CYAN}ðŸ‘‹$(ui_spaces)æ±Ÿæ¹–æœ‰ç¼˜å†è§ã€‚${LIGHT_WHITE}"
    ui line
    sleep 1
    ui clear
    exit 0
}
