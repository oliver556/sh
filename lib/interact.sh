#!/usr/bin/env bash

# ==============================================================================
# VpsScriptKit - äº¤äº’ç¡®è®¤å·¥å…·
#
# @æ–‡ä»¶è·¯å¾„: lib/interact.sh
# @åŠŸèƒ½æè¿°: è´Ÿè´£ â€œé—®â€ (ç¡®è®¤æ¡†ã€è¾“å…¥æ¡†ã€ç­‰å¾…æŒ‰é”®)ã€‚
#
# @ä½œè€…: Jamison
# @ç‰ˆæœ¬: 0.1.0
# @åˆ›å»ºæ—¥æœŸ: 2025-12-30
# ==============================================================================

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_spaces
# åŠŸèƒ½:   ç”ŸæˆæŒ‡å®šæ•°é‡çš„ç©ºæ ¼å­—ç¬¦ä¸²
# 
# å‚æ•°:
#   $1 (number): éœ€è¦çš„ç©ºæ ¼æ•°é‡ (å¯é€‰)
# 
# è¿”å›å€¼: éœ€è¦çš„ç©ºæ ¼æ•°é‡
# 
# ç¤ºä¾‹:
#   "A$(ui_spaces 2)B"
# ------------------------------------------------------------------------------
ui_spaces() {
    local count="${1:-2}"
    ((count < 0)) && count=0
    printf "%*s" "$count" ""
}

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_confirm
# åŠŸèƒ½:   æŒ‰ (Y/y) é”®ç¡®è®¤ï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›/å–æ¶ˆ
# 
# å‚æ•°:
#   $1 (number): æç¤ºä¿¡æ¯ (é»˜è®¤: ç¡®è®¤æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ)
# 
# è¿”å›å€¼:
#   0 - ç¡®è®¤
#   1 - å–æ¶ˆ
# 
# ç¤ºä¾‹:
#  if ! ui_confirm " æ³¨æ„: ç¡®å®š***å—ï¼Ÿ; then
#      return 1
#  fi
# ------------------------------------------------------------------------------
ui_confirm() {
    local title="$1"
    local user_choice

    ui blank
    # å¦‚æœ title ä¸ä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºå…·ä½“çš„æ ‡é¢˜æç¤º
    if [ -n "$title" ]; then
        ui echo "æŒ‰ ${BOLD_RED}(Y/y)${LIGHT_WHITE} é”®ç¡®è®¤æ‰§è¡Œ ${LIGHT_CYAN}${title}${LIGHT_WHITE}ï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›ã€‚"
    else
        ui echo "æŒ‰ ${BOLD_RED}(Y/y)${LIGHT_WHITE} é”®ç¡®è®¤æ‰§è¡Œï¼ŒæŒ‰å…¶å®ƒä»»æ„é”®è¿”å›ã€‚"
    fi
    
    ui blank

    user_choice=$(ui_read_choice)

    case "$user_choice" in
        y|Y)
            return 0  # è¿”å› 0, ä»£è¡¨â€œç¡®è®¤/ç»§ç»­â€
            ;;
        *)
            echo -e "\n${BOLD_YELLOW}æ“ä½œå·²å–æ¶ˆ...${LIGHT_WHITE}"
            sleep 1
            return 1  # è¿”å› 1, ä»£è¡¨â€œå¤±è´¥/å–æ¶ˆâ€
            ;;
    esac
}

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_wait_enter
# åŠŸèƒ½:   æµç¨‹ä¸­çš„ä¸´æ—¶æš‚åœï¼Œâ€œå›è½¦é”®â€œ ç»§ç»­
# 
# å‚æ•°: æ— 
# 
# è¿”å›å€¼: æ— 
# 
# ç¤ºä¾‹:
#   ui_wait_enter
# ------------------------------------------------------------------------------
ui_wait_enter() {
    ui blank
    ui echo "${BOLD_LIGHT_GREEN}æ‰§è¡Œå®Œæˆ${LIGHT_WHITE}"
    ui echo "${BOLD_LIGHT_WHITE}æŒ‰å›è½¦é”®ç»§ç»­...${LIGHT_WHITE}"
    # ä¸å¸¦ -nï¼Œå¼ºåˆ¶ç­‰å¾…å›è½¦
    # -s: é™é»˜æ¨¡å¼ï¼Œä¸å›æ˜¾è¾“å…¥
    # -r: å…è®¸åæ–œæ 
    read -s -r
}

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_wait
# åŠŸèƒ½:  æµç¨‹ä¸­çš„ä¸´æ—¶æš‚åœï¼Œâ€œä»»æ„é”®â€œ ç»§ç»­
# 
# å‚æ•°: æ— 
# 
# è¿”å›å€¼: æ— 
# 
# ç¤ºä¾‹:
#   ui_wait
# ------------------------------------------------------------------------------
ui_wait() {
    ui blank
    ui echo "${LIGHT_CYAN}æŒ‰ä»»æ„é”®ç»§ç»­...${LIGHT_WHITE}"
    # -n 1: è¯»å– 1 ä¸ªå­—ç¬¦ç«‹å³è¿”å›
    # -s: é™é»˜æ¨¡å¼ï¼Œä¸å›æ˜¾è¾“å…¥
    # -r: å…è®¸åæ–œæ 
    read -n 1 -s -r
}

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_input
# åŠŸèƒ½:   è·å–ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬æ•°æ®ã€‚æ”¯æŒè®¾ç½®é»˜è®¤å€¼
# 
# å‚æ•°:
#   $1 (string): æç¤ºè¯­ (å¿…å¡«)
#   $2 ([ç±»å‹]): [æè¿°å‚æ•°2çš„å«ä¹‰]
# 
# è¿”å›å€¼: è¿”å› echo çš„å€¼
# 
# ç¤ºä¾‹:
#   ui_input "$1"
# ------------------------------------------------------------------------------
ui_input() {
    local prompt="$1"
    local default_val="${2:-}"
    local input_val
    
    if [ -n "$default_val" ]; then
        read -rp "$(ui echo "ğŸ‘‰${LIGHT_CYAN}$(ui_spaces)${prompt} [é»˜è®¤: ${BOLD_WHITE}${default_val}${LIGHT_CYAN}]: ${LIGHT_WHITE}")" input_val
        echo "${input_val:-$default_val}"
    else
        read -rp "$(ui echo "ğŸ‘‰${LIGHT_CYAN}$(ui_spaces)${prompt}: ${LIGHT_WHITE}")" input_val
        echo "$input_val"
    fi
}

# ------------------------------------------------------------------------------
# å‡½æ•°å: ui_read_choice
# åŠŸèƒ½:   ä¸“é—¨ç”¨äºèœå•é€‰æ‹©çš„è¯»å–ã€‚ä½œä¸º ui_input çš„å¿«æ·å°è£…ã€‚
# 
# å‚æ•°: æ— 
# 
# è¿”å›å€¼: è¿”å› echo çš„å€¼
# 
# ç¤ºä¾‹:
#   ui_read_choice "$1"
# ------------------------------------------------------------------------------
ui_read_choice() {
    # ç»Ÿä¸€è°ƒç”¨ ui_inputï¼Œä¿æŒç•Œé¢æŒ‡å¼•ç¬¦å’Œé€»è¾‘çš„ä¸€è‡´æ€§
    ui_input "è¯·è¾“å…¥é€‰é¡¹"
}
