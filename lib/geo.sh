#!/usr/bin/env bash

# ==============================================================================
# VpsScriptKit - ISP / 地理位置
#
# @文件路径: lib/geo.sh
# @功能描述: 提供 ISP / 地理位置
#
# @作者: Jamison
# @版本: 0.1.0
# @创建日期: 2026-01-12
# ==============================================================================

# ******************************************************************************
# 网络扩展信息（外部 API）
# ******************************************************************************

# ------------------------------------------------------------------------------
# 函数名: net_get_isp
# 功能:   获取 ISP / 运营商
# 
# 参数:
#   无
# 
# 返回值:
#   成功: ISP / 运营商
#   失败: N/A
# 
# 示例:
#   net_get_isp
# ------------------------------------------------------------------------------
net_get_isp() {
    # 使用 ipinfo.io JSON 接口获取 ISP
    curl -s https://ipinfo.io/org || echo "N/A"
}

# ------------------------------------------------------------------------------
# 函数名: net_get_geo
# 功能:   获取获取地理位置
# 
# 参数:
#   无
# 
# 返回值:
#   成功: 地理位置
#   失败: 未获取到地理位置
# 
# 示例:
#   net_get_geo
# ------------------------------------------------------------------------------
net_get_geo() {
    local ipinfo
    # 获取完整的 json 用于拆分
    ipinfo=$(curl -s --max-time 2 https://ipinfo.io/json)
    
    if [[ -z "$ipinfo" ]]; then
        ui echo "未获取到地理位置"
        return
    fi

    # 按照您提供的逻辑拆分
    local country=$(ui echo "$ipinfo" | grep 'country' | awk -F': ' '{print $2}' | tr -d '",')
    local city=$(ui echo "$ipinfo" | grep 'city' | awk -F': ' '{print $2}' | tr -d '",')

    if [[ -n "$country" && -n "$city" ]]; then
        # 输出格式：US Los Angeles
        ui echo "${country} ${city}" | xargs
    else
        ui echo "未获取到地理位置"
    fi
}