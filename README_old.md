# VpsScriptKit 脚本工程规范说明

## 一、项目定位说明

**VpsScriptKit** 是一款面向 VPS / Linux 服务器的 **综合型 CLI 管理脚本工具集**，目标是：

- 提供统一入口（`v`）的管理体验
- 支持模块化功能扩展与裁剪
- 支持安装、更新、卸载、日志记录
- 遵循 Linux 文件系统层级标准（FHS）
- 可长期维护、可二次开发、可持续扩展

---

## 二、整体架构设计

### 架构分层

VpsScriptKit 采用**分层架构**，各层职责清晰，禁止越权调用：

```text
CLI 入口层      →  v 命令
控制调度层       →  主入口 / 路由
业务模块层       →  各功能模块
通用库层         →  工具 / 判断 / 日志
数据与状态层      →  配置 / 日志 / 状态
```

### 分层职责说明

| 层级 | 职责 |
|:---|:---|
| CLI 入口 | 用户启动脚本 |
| 控制调度 | 初始化、菜单、路由 |
| 业务模块 | 实际功能实现 |
| 通用库 | 公共能力封装 |
| 数据层 | 持久化数据 |

---

## 三、目录结构规范（强制）

```text
/usr/local/VpsScriptKit/
├── bin/                     # 启动命令
│   └── v                    # 快捷入口
│
├── core/                    # 核心控制层
│   ├── main.sh              # 主入口（唯一）
│   ├── router.sh            # 菜单 / 命令路由
│   └── bootstrap.sh         # 初始化加载
│
├── modules/                 # 功能模块（可插拔）
│   ├── system/              # 系统工具
│   ├── basic/               # 基础工具
│   ├── advanced/            # 进阶工具
│   ├── docker/              # Docker 管理
│   ├── test/                # 测试脚本合集
│   ├── node/                # 节点搭建脚本
│   └── script/              # 脚本工具
│
├── lib/                     # 通用库（禁止业务逻辑）
│   ├── ui.sh                # 界面 / 输出
│   ├── log.sh               # 日志系统
│   ├── check.sh             # 判断检测
│   ├── env.sh               # 环境检测
│   └── utils.sh             # 通用工具
│
├── config/                  # 配置文件
│   └── app.conf             # 全局配置
│
├── data/                    # 状态数据
│   └── state.json           # 模块 / 安装状态
│
├── logs/                    # 日志文件
│   └── vpsscriptkit.log
│
├── version                  # 当前版本号
├── install.sh               # 安装脚本（一次性）
├── update.sh                # 更新脚本
└── uninstall.sh             # 卸载脚本
```

---

## 四、入口与启动规范

### 1. CLI 快捷命令

- 命令名：`v`
- 存放位置：`/usr/local/bin/v`
- 仅作为 **转发入口**

示例：

```bash
#!/bin/bash
exec /usr/local/VpsScriptKit/core/main.sh "$@"
```

---

### 2. 主入口脚本（main.sh）

**职责限制：**

- 初始化运行环境
- 加载通用库
- 调用路由 / 菜单
- 接收命令行参数

**禁止行为：**

- ❌ 直接执行系统操作
- ❌ 实现具体业务逻辑
- ❌ 写复杂判断流程

---

## 五、模块设计规范

### 模块基本规则

- 每个模块是一个**独立目录**
- 模块之间禁止直接调用
- 模块只通过 router 调度
- 模块可被单独启用 / 禁用

### 模块内部建议结构

```text
docker/
├── menu.sh        # 子菜单
├── install.sh     # 安装逻辑
├── manage.sh      # 管理逻辑
└── uninstall.sh   # 卸载逻辑
```

---

## 六、通用库（lib）规范（重点）

### 1. lib 的定位

`lib` 目录 **只允许存在通用能力**，不允许出现任何业务行为。

### 2. 必备通用库职责

#### ui.sh

- 统一界面风格
- 菜单渲染
- 彩色输出
- 分隔线 / 标题

#### log.sh

- 操作日志记录
- 统一时间格式
- info / warn / error 分级

#### check.sh

- root 权限检测
- 系统类型判断
- 软件是否安装
- 端口 / 网络检查

#### utils.sh

- 错误处理
- 重试机制
- 安全执行封装
- 统一退出控制

---

## 七、日志规范

### 日志类型

#### 操作日志（必须）

- 文件位置：`/usr/local/VpsScriptKit/logs/vpsscriptkit.log`
- 记录内容：
  - 时间
  - 操作类型
  - 模块
  - 结果

示例：

```text
2025-03-21 22:14 [docker] install success
```

---

## 八、更新 / 卸载规范

### 更新（update.sh）

- 支持覆盖更新
- 保留用户配置
- 自动更新 version 文件
- 记录更新日志

### 卸载（uninstall.sh）

- 提示用户确认
- 清理：
  - 程序目录
  - 快捷命令
  - 日志（可选）
- 不影响系统其他组件

---

## 九、版本规范

- 版本文件：`version`
- 采用语义化版本：

```text
主版本.次版本.修订版本
```

示例：

```text
0.0.54
```

---

## 十、设计原则（核心）

- **单一职责**
- **模块隔离**
- **最小侵入**
- **可读性优先于技巧**
- **宁可多一层，也不混在一起**

---

## 十一、未来扩展方向（预留）

- 命令行参数模式（`v install docker`）
- 无交互模式（CI / 自动化）
- 模块独立升级
- 配置文件驱动行为
- 国际化（i18n）

---

> VpsScriptKit 不是“快写完就丢”的脚本，  
> 而是一个可以陪伴服务器整个生命周期的工具。
