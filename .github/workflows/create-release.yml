# .github/workflows/create-release.yml

# å·¥ä½œæµåç§°
name: Create and Publish Release

# è§¦å‘æ¡ä»¶
on:
  push:
    tags:
      - 'v*.*.*'

# å®šä¹‰å·¥ä½œæµä¸­çš„ä»»åŠ¡
jobs:
  create-release:
    # ä»»åŠ¡åç§°
    name: Create Release Package
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest
    # æˆäºˆå†™å…¥æƒé™
    permissions:
      contents: write

    # ä»»åŠ¡æ­¥éª¤
    steps:
      # ç¬¬ 1 æ­¥: æ£€å‡ºä»“åº“ä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4

      # ç¬¬ 2 æ­¥: å‡†å¤‡å˜é‡ (æ–¹ä¾¿è‡ªå®šä¹‰)
      - name: Set up release variables
        run: |
          # å®šä¹‰æ–‡ä»¶å
          ASSET_NAME="VpsScriptKit-${{ github.ref_name }}.tar.gz"
          echo "ASSET_NAME=$ASSET_NAME" >> $GITHUB_ENV
          echo "SHA_NAME=${ASSET_NAME}.sha256" >> $GITHUB_ENV

      # ç¬¬ 3 æ­¥: 
      - name: Create release archive
        # ä½¿ç”¨ --prefix ç¡®ä¿å‹ç¼©åŒ…å†…å«æœ‰ä¸€å±‚ç›®å½•ï¼Œé€‚é… install.sh çš„ --strip-components=1
        run: |
          git archive -o ${{ env.ASSET_NAME }} --format=tar.gz --prefix=VpsScriptKit/ HEAD

       # ç¬¬ 4 æ­¥: ç”Ÿæˆ install.sh æ‰€éœ€çš„æ ¡éªŒæ–‡ä»¶
      - name: Generate SHA256 checksum
        run: |
          sha256sum ${{ env.ASSET_NAME }} > ${{ env.SHA_NAME }}

      # ç¬¬ 5 æ­¥: åˆ›å»ºå¸¦ç‰ˆæœ¬å·çš„ Release
      - name: Create Versioned Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.ref_name }}
          # Release çš„æ ‡é¢˜ç›´æ¥ä½¿ç”¨ç‰ˆæœ¬å·
          name: Release ${{ github.ref_name }}
          # ğŸš€ è¿™æ˜¯ Release çš„æè¿°å†…å®¹
          body: "VpsScriptKit é¡¹ç›®ï¼Œç®€ç§° vsk é¡¹ç›®ã€‚"
          files: |
            ${{ env.ASSET_NAME }}
            ${{ env.SHA_NAME }}
          prerelease: ${{ contains(github.ref, '-') }}